<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>亚太地区商学院统计赛</title>
		<link rel="stylesheet" type="text/css" href="/views/pc/css/fonts.css" />
		<link rel="stylesheet" type="text/css" href="/views/pc/css/bootstrap/css/bootstrap.css" />
		<link rel="stylesheet" type="text/css" href="/views/pc/css/common/common.css" />
		<script src="/views/pc/js/jquery-2.1.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="/views/pc/css/bootstrap/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="/views/pc/css/each/index.css" />
		<link rel="stylesheet" type="text/css" href="/views/pc/css/each/allEvents.css" />
		<link rel="stylesheet" type="text/css" href="/views/pc/css/each/enter.css" />
		<link rel="stylesheet" type="text/css" href="/views/pc/css/animate/animate.css" />
		<script src="/views/pc/js/include.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="/views/pc/css/common/idangerous.swiper.css" />
		<!--<script src="/views/pc/js/language-2.js" type="text/javascript" charset="utf-8"></script>-->
		<style type="text/css">
			.swiper-slide {
				display: -webkit-box;
				display: -ms-flexbox;
				display: -webkit-flex;
				display: flex;
				-webkit-box-pack: center;
				-ms-flex-pack: center;
				-webkit-justify-content: center;
				justify-content: center;
				-webkit-box-align: center;
				-ms-flex-align: center;
				-webkit-align-items: center;
				align-items: center;
			}
			
			@media only screen and (min-width: 768px) {
				.enter-information .ticket-type ul li {
					width: 384px !important;
					height: 112px !important;
				}
			}
		</style>
	</head>

	<body>
		<div class="index-content">
			<!--左侧导航-->
			<nav class="navbar">
				<div class="container-fluid">
					<div class="navbar-header">
						<div type="button" id="nav-button">
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</div>
						<a class="navbar-brand" href="#">
							<img src="/views/pc/img/index/logo.png" class="pull-left" />
							<div class="pull-right">
								<span>亚太地区商学院</span><br />
								<span>挑战赛</span>
							</div>
							<hr />
						</a>
					</div>
					<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
						<ul class="nav-list">
							<li>
								<a href="/views/pc/index.html">首页</a><br />
							</li>
							<li class="page">
								<a href=" http://139.129.210.241:85/events/index">全部赛事</a><br />
								<span>ALL EVENTS</span>
								<i></i>
							</li>
							<li>
								<a href="http://139.129.210.241:85/news/index">赛事新闻</a>
							</li>
							<li>
								<a href="http://139.129.210.241:85/news/about">关于我们</a>
							</li>
						</ul>
					</div>

					<div class="nav-bottom">
						<p>国际商学院 <span>王红妍</span></p>
						<p>+86 1350-1365-706</p>
						<p>hongyan.wang@ruc.edu.cn</p>
					</div>
				</div>
			</nav>
			<div class="mobile-bar">
				<ul class="nav-list">
					<li>
						<a href="/views/pc/index.html">首页</a>
					</li>
					<li>
						<a href="http://139.129.210.241:85/events/index">全部赛事</a>
					</li>
					<li>
						<a href="http://139.129.210.241:85/eventsIntroduce/regulations">赛事新闻</a>
					</li>
					<li>
						<a href="http://139.129.210.241:85/news/about">关于我们</a>
					</li>
				</ul>
			</div>
			<div id="change">
				<span class="now opacity6">中</span>
				<i class="opacity6"></i>
				<span class="opacity6">EN</span>
			</div>

			<!--全部赛事-->
			<div class="allEvents">
				<div id="Events" class="starting">
					<div class="coming-soon">
						<p>即将开始赛事</p>
						<p id="timeChange"></p>
						<hr />
						<div class="time">
							<span class="data" id="startTime">08/03</span>
							<span class="week">Wed</span>
							<span class="year" id="eventYear">2018</span>
							<span class="data" id="endTime">08/06</span>
							<span class="week">Fri</span>
						</div>
					</div>
					<div class="event-content">
						<div>
							<p class="year" id="eventYear">2018</p>
							<h4 id="eventName">第三届草原挑战赛</h4>
							<p class="area opacity6" id="eventPlace">内蒙古<i></i>辉腾锡勒草原</p>
						</div>
					</div>
				</div>
				<div class="mobile-events">
					<div>
						<p>赛事名称：<span class="fontWeight300" id="eventName2"></span></p>
						<p>赛事地点：<span class="fontWeight300" id="eventPlace2">内蒙古 - 辉腾锡勒草原</span></p>
						<p>赛事时间：<span class="fontWeight300" id="mobileTime">2018/08/03 - 2018/08/06</span></p>
					</div>

				</div>
				<!--<form action="" method="post">-->

				<div class="enter-information">
					<form action="##" method="post" id="form1" onsubmit="return false">

						<div class="ticket-type swiper-container">
							<h5>票类型</h5>
							<ul class="list-inline swiper-wrapper">
								<li class="early-bird swiper-slide">
									<div class="clearfix">
										<span class="pull-left" class="typeName">早鸟票</span>
										<p class="pull-right">数量：<span class="font-num" id="priceNum">20</span></p>
									</div>
									<div class="clearfix">
										<p class="pull-left">
											<span>开票时间</span><br />
											<span class="opacity6" id="timePrice">07/23 - 07/29</span>
										</p>
										<div class="pull-right clearfix money">
											<p class="opacity6 old-price">原价 <span class="font-num font16 fontBold" id="oldPrice">￥ 4999</span></p>
											<p>现价<span class="font-num now-price" id="newPrice">￥ 3999</span></p>
										</div>
									</div>
									<div class="border"></div>
								</li>
							</ul>
						</div>
						<!--<form action="" id="form1">-->
						<div class="ticketWrap">
							<div class="personnal">
								<h5>填写个人信息</h5>
								<div>

									<div class="form-group">
										<label for="userName"><span>*</span>姓名&性别</label>
										<input type="text" name="" value="" placeholder="请填写姓名" class="form-control input-width-long userName" />
										<select name="" class="form-control  pull-right gender" style="width: 30%; position: relative; top: 7px;">
											<option value="1">男</option>
											<option value="0">女</option>
										</select>
									</div>
									<div class="form-group form-width">
										<label for="userMobile"><span>*</span>手机号</label>
										<input type="text" value="法国(+33)" class="form-control input-width-short" />
										<input type="text" name="" value="" placeholder="请填写手机号" class="form-control input-width-long pull-right userMobile" />
									</div>
									<div class="form-group">
										<label for="userMail"><span>*</span>邮箱号</label>
										<input type="text" name="" value="" placeholder="请填写邮箱号" class="form-control userMail" />
									</div>
									<div class="form-group form-width">
										<label for="userMail"><span>*</span>护照号</label>
										<input type="text" name="" value="" placeholder="请填写护照号" class="form-control userPassword" />
									</div>

								</div>
							</div>
						</div>
					</form>
					<div class="addPerson">
						<button id="addPerson">+ 添加他人</button>
						<div class="sure">
							<i class="check-box"></i>
							<span class="opacity6 fontWeight300">我确认所提供的信息是正确和真实的。如果发现信息不正确或错误，注册可能会被取消而不予退款。我承认这张票是不可退款的。</span>
						</div>
					</div>
					<div class="attention">
						<h5>注意事项</h5>
						<div id="attentions">
						</div>
					</div>
				</div>
				<div class="pay">
					<div class="pull-left">
						<span class="fontWeight300 opacity6">票类型：</span>
						<span class="font-num type" class="typeName">早鸟票</span>
						<span class="fontWeight300 opacity6">人数：</span>
						<span class="font-num" id="totalPerson">1</span>
						<span class="fontWeight300 opacity6 cost">费用：</span>
						<span class="font-num" id="totalPrice">￥3999</span>
					</div>
					<!--<input type="submit" name="pay" id="pay" value="前去支付" class="pull-right"/>-->
					<button class="pull-right" id="pay"><img src="/views/pc/img/icon/payicon.svg"/>前去支付</button>
				</div>

			</div>
			<!--</form>-->
		</div>
	</body>
	<script src="../../js/jquery-form.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		$(".Events").on("click", function() {
			window.location.href = 'http://139.129.210.241:85/events/index'
		})
		var enterId = window.sessionStorage.getItem("enterId");
		var eventId = window.sessionStorage.getItem("eventId");
		console.log(eventId)
		var price;
		function getEvents() {
			$.ajax({
				type: "post",
				url: "/admin/eventsReport/getById",
				data: {
					eventId: enterId
				},
				async: false,
				dataType: "json",
				success: function(data) {
					if(data.success) {
						$(".typeName").text(data.data.name)
						$("#priceNum").text(data.data.total);
						$("#oldPrice").text(data.data.oriPrice)
						$("#newPrice").text(data.data.prePrice)
						$("#timePrice").text(data.data.startTime.substring(5, 10) + "-" + data.data.endTime.substring(5, 10));
						price=data.data.prePrice;
						$("#totalPrice").text(data.data.prePrice);
						for (var i=0;i<data.data.attentions.length;i++) {
							var attentions=$("<p><img src='/views/pc/img/icon/combined-shape.svg' /><span class='opacity6'>"+data.data.attentions[i] +"</span></p>");
							$("#attentions").append(attentions)
						}
					}
				}
			});
		}
		getEvents()
		$.ajax({
			type: "post",
			url: "/admin/events/getEventsById",
			data: {
				id: eventId
			},
			async: true,
			dataType: "json",
			success: function(data) {
				if(data.success) {
					$("#startTime").text(data.data.startTime.substring(5, 7) + "/" + data.data.startTime.substring(8, 10))
					$("#endTime").text(data.data.endTime.substring(5, 7) + "/" + data.data.endTime.substring(8, 10))
					$("#eventYear").text(data.data.createTime.substring(0, 4))
					$("#eventName").text(data.data.name)
					$("#eventPlace").text(data.data.place)
					$("#eventName2").text(data.data.name)
					$("#eventPlace2").text(data.data.place)
					$("#eventDay").text(data.data.dayMiles.length);
					$("#mobileTime").text(data.data.createTime.substring(0,10)+"-"+data.data.endTime.substring(0,10))
					var dayMiles = 0;
					var oneMiles = "";
					for(var i = 0; i < data.data.dayMiles.length; i++) {
						dayMiles += parseInt(data.data.dayMiles[i])

						oneMiles += data.data.dayMiles[i] + "公里" + "+"
					}
					$("#eventMiles").text(dayMiles)
					$("#milesDetails").text(oneMiles.substring(0, oneMiles.length - 1))
				}
			}
		})
		$.ajax({
			type: "post",
			url: "/admin/events/getEventsById",
			data: {
				id: eventId
			},
			async: true,
			dataType: "json",
			success: function(data) {
				if(data.success) {
					function show_time() {
						var time = data.data.endTime;
						var dateee = new Date(time).toJSON();            
						var date = new Date(+new Date(dateee) + 8 * 3600 * 1000).toISOString().replace(/T/g, ' ').replace(/\.[\d]{3}Z/, '');
						var time_start = new Date().getTime(); //设定当前时间
						var time_end = new Date(date.replace(/-/g, "/")).getTime(); //设定目标时间
						// 计算时间差 
						var time_distance = time_end - time_start;
						// 天
						var int_day = Math.floor(time_distance / 86400000)
						time_distance -= int_day * 86400000;
						// 时
						var int_hour = Math.floor(time_distance / 3600000)
						time_distance -= int_hour * 3600000;
						// 分
						var int_minute = Math.floor(time_distance / 60000)
						time_distance -= int_minute * 60000;
						// 秒 
						var int_second = Math.floor(time_distance / 1000)
						// 时分秒为单数时、前面加零 
						if(int_day < 10) {
							int_day = "0" + int_day;
						}
						if(int_hour < 10) {
							int_hour = "0" + int_hour;
						}
						if(int_minute < 10) {
							int_minute = "0" + int_minute;
						}
						if(int_second < 10) {
							int_second = "0" + int_second;
						}
						$("#timeChange").text(int_day + ":" + int_hour + ":" + int_minute + ":" + int_second);
						setTimeout(show_time, 1000)
					}
					show_time()
					$("#startTime").text(data.data.startTime.substring(5, 7) + "/" + data.data.startTime.substring(8, 10))
					$("#endTime").text(data.data.endTime.substring(5, 7) + "/" + data.data.endTime.substring(8, 10))
					$("#eventYear").text(data.data.createTime.substring(0, 4))
					$("#eventName").text(data.data.name)
					$("#eventPlace").text(data.data.place)
					$("#eventDay").text(data.data.dayMiles.length);
					var dayMiles = 0;
					var oneMiles = "";
					for(var i = 0; i < data.data.dayMiles.length; i++) {
						dayMiles += parseInt(data.data.dayMiles[i])

						oneMiles += data.data.dayMiles[i] + "公里" + "+"
					}
					$("#eventMiles").text(dayMiles)
					$("#milesDetails").text(oneMiles.substring(0, oneMiles.length - 1))
				}
			}
		})
		var num=1;
		$("#addPerson").click(function() {
			var ticketWrap = $(".ticketWrap").last().clone();
			$(".ticketWrap").last().after(ticketWrap)
			num++;
			$("#totalPerson").text(num)
			$("#totalPrice").text(price*num)
		})

		function pay() {

			$("#pay").click(function() {
				var name = [];
				for(let i = 0; i < $(".userName").length; i++) {
					name.push($(".userName").eq(i).val())
				}
				var userMobile = [];
				for(let i = 0; i < $(".userMobile").length; i++) {
					userMobile.push($(".userMobile").eq(i).val())
				}
				var userMobile = [];
				for(let i = 0; i < $(".userMobile").length; i++) {
					userMobile.push($(".userMobile").eq(i).val())
				}
				var userMail = [];
				for(let i = 0; i < $(".userMail").length; i++) {
					userMail.push($(".userMail").eq(i).val())
				}
				var userPassword = [];
				for(let i = 0; i < $(".userPassword").length; i++) {
					userPassword.push($(".userPassword").eq(i).val())
				}
				var genders = [];
				for(let i = 0; i < $(".gender").length; i++) {
					genders.push($(".gender").eq(i).val())
				}

				var payNum = $(".ticketWrap").length;
				var price =$("#totalPrice").text();
				var data = {
					eventId: 17,
					buy_name: "早鸟票",
					names: name,
					genders: genders,
					phones: userMobile,
					emails: userMail,
					passports: userPassword,
					num: payNum,
					price: price
				}
				console.log(data)
				var ajaxFormOption = {
					type: "post", //提交方式 
					dataType: "json", //数据类型 
					data: data, //自定义数据参数，视情况添加
					url: "/order/pay", //请求url 
					success: function(data) { //提交成功的回调函数 
						if(data.success) {
							window.location.href = data.data
						}
					},
					error: function(data) {
						console.log(data)
					}

				}
				$("#form1").ajaxSubmit(ajaxFormOption);
			})
		}
		pay()
	</script>
	<script src="/views/pc/js/common.js" type="text/javascript" charset="utf-8"></script>
	<script src="/views/pc/js/idangerous.swiper.min.js" type="text/javascript" charset="utf-8"></script>
	<!--<script type="text/javascript">
		$("#change").click(function() {
			translate();
		})
	</script>-->
	<script type="text/javascript">
		var swiper = new Swiper('.swiper-container', {
			slidesPerView: 1,
			spaceBetween: 30,
		});
	</script>

</html>

..